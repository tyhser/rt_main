#include <stdint.h>

const static struct _ntc_tab {
	float t;
	uint32_t r;
} ntc_tab[] =

{{-20.0, 9676110},
{-19.9, 9620230},
{-19.8, 9564710},
{-19.7, 9509540},
{-19.6, 9454730},
{-19.5, 9400270},
{-19.4, 9346160},
{-19.3, 9292390},
{-19.2, 9238970},
{-19.1, 9185890},
{-19.0, 9133150},
{-18.9, 9080750},
{-18.8, 9028680},
{-18.7, 8976950},
{-18.6, 8925540},
{-18.5, 8874460},
{-18.4, 8823710},
{-18.3, 8773280},
{-18.2, 8723170},
{-18.1, 8673380},
{-18.0, 8623900},
{-17.9, 8574750},
{-17.8, 8525900},
{-17.7, 8477360},
{-17.6, 8429130},
{-17.5, 8381200},
{-17.4, 8333580},
{-17.3, 8286260},
{-17.2, 8239240},
{-17.1, 8192520},
{-17.0, 8146090},
{-16.9, 8099960},
{-16.8, 8054110},
{-16.7, 8008560},
{-16.6, 7963288},
{-16.5, 7918305},
{-16.4, 7873604},
{-16.3, 7829186},
{-16.2, 7785046},
{-16.1, 7741183},
{-16.0, 7697596},
{-15.9, 7654282},
{-15.8, 7611240},
{-15.7, 7568468},
{-15.6, 7525963},
{-15.5, 7483725},
{-15.4, 7441750},
{-15.3, 7400038},
{-15.2, 7358587},
{-15.1, 7317395},
{-15.0, 7276459},
{-14.9, 7235779},
{-14.8, 7195352},
{-14.7, 7155177},
{-14.6, 7115252},
{-14.5, 7075576},
{-14.4, 7036146},
{-14.3, 6996961},
{-14.2, 6958020},
{-14.1, 6919320},
{-14.0, 6880860},
{-13.9, 6842639},
{-13.8, 6804654},
{-13.7, 6766904},
{-13.6, 6729388},
{-13.5, 6692105},
{-13.4, 6655051},
{-13.3, 6618226},
{-13.2, 6581629},
{-13.1, 6545257},
{-13.0, 6509110},
{-12.9, 6473185},
{-12.8, 6437481},
{-12.7, 6401997},
{-12.6, 6366732},
{-12.5, 6331683},
{-12.4, 6296849},
{-12.3, 6262230},
{-12.2, 6227822},
{-12.1, 6193626},
{-12.0, 6159639},
{-11.9, 6125860},
{-11.8, 6092288},
{-11.7, 6058922},
{-11.6, 6025759},
{-11.5, 5992799},
{-11.4, 5960040},
{-11.3, 5927481},
{-11.2, 5895121},
{-11.1, 5862958},
{-11.0, 5830991},
{-10.9, 5799218},
{-10.8, 5767639},
{-10.7, 5736252},
{-10.6, 5705055},
{-10.5, 5674048},
{-10.4, 5643229},
{-10.3, 5612597},
{-10.2, 5582151},
{-10.1, 5551889},
{-10.0, 5521810},
{-9.9, 5491914},
{-9.8, 5462198},
{-9.7, 5432662},
{-9.6, 5403304},
{-9.5, 5374123},
{-9.4, 5345119},
{-9.3, 5316289},
{-9.2, 5287633},
{-9.1, 5259150},
{-9.0, 5230838},
{-8.9, 5202696},
{-8.8, 5174724},
{-8.7, 5146920},
{-8.6, 5119282},
{-8.5, 5091811},
{-8.4, 5064504},
{-8.3, 5037361},
{-8.2, 5010380},
{-8.1, 4983561},
{-8.0, 4956902},
{-7.9, 4930403},
{-7.8, 4904062},
{-7.7, 4877879},
{-7.6, 4851852},
{-7.5, 4825980},
{-7.4, 4800262},
{-7.3, 4774697},
{-7.2, 4749285},
{-7.1, 4724024},
{-7.0, 4698913},
{-6.9, 4673952},
{-6.8, 4649138},
{-6.7, 4624472},
{-6.6, 4599953},
{-6.5, 4575579},
{-6.4, 4551349},
{-6.3, 4527263},
{-6.2, 4503319},
{-6.1, 4479517},
{-6.0, 4455856},
{-5.9, 4432334},
{-5.8, 4408952},
{-5.7, 4385707},
{-5.6, 4362600},
{-5.5, 4339628},
{-5.4, 4316793},
{-5.3, 4294091},
{-5.2, 4271523},
{-5.1, 4249088},
{-5.0, 4226785},
{-4.9, 4204613},
{-4.8, 4182571},
{-4.7, 4160658},
{-4.6, 4138873},
{-4.5, 4117217},
{-4.4, 4095687},
{-4.3, 4074283},
{-4.2, 4053005},
{-4.1, 4031851},
{-4.0, 4010820},
{-3.9, 3989913},
{-3.8, 3969127},
{-3.7, 3948462},
{-3.6, 3927918},
{-3.5, 3907494},
{-3.4, 3887189},
{-3.3, 3867002},
{-3.2, 3846932},
{-3.1, 3826979},
{-3.0, 3807141},
{-2.9, 3787419},
{-2.8, 3767812},
{-2.7, 3748318},
{-2.6, 3728937},
{-2.5, 3709668},
{-2.4, 3690511},
{-2.3, 3671464},
{-2.2, 3652528},
{-2.1, 3633701},
{-2.0, 3614983},
{-1.9, 3596373},
{-1.8, 3577870},
{-1.7, 3559474},
{-1.6, 3541184},
{-1.5, 3523000},
{-1.4, 3504919},
{-1.3, 3486943},
{-1.2, 3469071},
{-1.1, 3451300},
{-1.0, 3433632},
{-0.9, 3416066},
{-0.8, 3398600},
{-0.7, 3381234},
{-0.6, 3363967},
{-0.5, 3346800},
{-0.4, 3329731},
{-0.3, 3312759},
{-0.2, 3295884},
{-0.1, 3279106},
{0.0, 3262423},
{0.1, 3245836},
{0.2, 3229343},
{0.3, 3212944},
{0.4, 3196638},
{0.5, 3180426},
{0.6, 3164305},
{0.7, 3148276},
{0.8, 3132339},
{0.9, 3116491},
{1.0, 3100734},
{1.1, 3085066},
{1.2, 3069487},
{1.3, 3053996},
{1.4, 3038593},
{1.5, 3023277},
{1.6, 3008047},
{1.7, 2992904},
{1.8, 2977846},
{1.9, 2962874},
{2.0, 2947985},
{2.1, 2933181},
{2.2, 2918460},
{2.3, 2903822},
{2.4, 2889266},
{2.5, 2874793},
{2.6, 2860400},
{2.7, 2846089},
{2.8, 2831858},
{2.9, 2817707},
{3.0, 2803635},
{3.1, 2789642},
{3.2, 2775727},
{3.3, 2761891},
{3.4, 2748131},
{3.5, 2734449},
{3.6, 2720844},
{3.7, 2707314},
{3.8, 2693860},
{3.9, 2680481},
{4.0, 2667176},
{4.1, 2653946},
{4.2, 2640789},
{4.3, 2627706},
{4.4, 2614695},
{4.5, 2601757},
{4.6, 2588891},
{4.7, 2576096},
{4.8, 2563372},
{4.9, 2550719},
{5.0, 2538136},
{5.1, 2525623},
{5.2, 2513179},
{5.3, 2500804},
{5.4, 2488497},
{5.5, 2476259},
{5.6, 2464088},
{5.7, 2451984},
{5.8, 2439947},
{5.9, 2427977},
{6.0, 2416073},
{6.1, 2404234},
{6.2, 2392460},
{6.3, 2380751},
{6.4, 2369107},
{6.5, 2357526},
{6.6, 2346010},
{6.7, 2334556},
{6.8, 2323165},
{6.9, 2311837},
{7.0, 2300571},
{7.1, 2289367},
{7.2, 2278224},
{7.3, 2267142},
{7.4, 2256120},
{7.5, 2245159},
{7.6, 2234258},
{7.7, 2223416},
{7.8, 2212634},
{7.9, 2201910},
{8.0, 2191245},
{8.1, 2180638},
{8.2, 2170088},
{8.3, 2159596},
{8.4, 2149161},
{8.5, 2138783},
{8.6, 2128461},
{8.7, 2118195},
{8.8, 2107985},
{8.9, 2097831},
{9.0, 2087731},
{9.1, 2077686},
{9.2, 2067695},
{9.3, 2057759},
{9.4, 2047876},
{9.5, 2038047},
{9.6, 2028270},
{9.7, 2018547},
{9.8, 2008876},
{9.9, 1999257},
{10.0, 1989690},
{10.1, 1980174},
{10.2, 1970710},
{10.3, 1961297},
{10.4, 1951934},
{10.5, 1942622},
{10.6, 1933359},
{10.7, 1924147},
{10.8, 1914983},
{10.9, 1905869},
{11.0, 1896804},
{11.1, 1887787},
{11.2, 1878819},
{11.3, 1869899},
{11.4, 1861026},
{11.5, 1852200},
{11.6, 1843422},
{11.7, 1834691},
{11.8, 1826006},
{11.9, 1817368},
{12.0, 1808775},
{12.1, 1800229},
{12.2, 1791728},
{12.3, 1783272},
{12.4, 1774861},
{12.5, 1766494},
{12.6, 1758173},
{12.7, 1749895},
{12.8, 1741661},
{12.9, 1733471},
{13.0, 1725325},
{13.1, 1717221},
{13.2, 1709160},
{13.3, 1701142},
{13.4, 1693167},
{13.5, 1685233},
{13.6, 1677342},
{13.7, 1669492},
{13.8, 1661683},
{13.9, 1653916},
{14.0, 1646190},
{14.1, 1638504},
{14.2, 1630859},
{14.3, 1623254},
{14.4, 1615689},
{14.5, 1608164},
{14.6, 1600678},
{14.7, 1593231},
{14.8, 1585824},
{14.9, 1578455},
{15.0, 1571126},
{15.1, 1563834},
{15.2, 1556581},
{15.3, 1549365},
{15.4, 1542187},
{15.5, 1535047},
{15.6, 1527944},
{15.7, 1520879},
{15.8, 1513850},
{15.9, 1506857},
{16.0, 1499901},
{16.1, 1492982},
{16.2, 1486098},
{16.3, 1479250},
{16.4, 1472438},
{16.5, 1465661},
{16.6, 1458920},
{16.7, 1452213},
{16.8, 1445541},
{16.9, 1438904},
{17.0, 1432301},
{17.1, 1425733},
{17.2, 1419198},
{17.3, 1412697},
{17.4, 1406230},
{17.5, 1399796},
{17.6, 1393395},
{17.7, 1387028},
{17.8, 1380693},
{17.9, 1374391},
{18.0, 1368122},
{18.1, 1361885},
{18.2, 1355679},
{18.3, 1349506},
{18.4, 1343365},
{18.5, 1337255},
{18.6, 1331176},
{18.7, 1325129},
{18.8, 1319113},
{18.9, 1313127},
{19.0, 1307173},
{19.1, 1301248},
{19.2, 1295354},
{19.3, 1289491},
{19.4, 1283657},
{19.5, 1277853},
{19.6, 1272079},
{19.7, 1266334},
{19.8, 1260618},
{19.9, 1254932},
{20.0, 1249275},
{20.1, 1243646},
{20.2, 1238046},
{20.3, 1232475},
{20.4, 1226932},
{20.5, 1221417},
{20.6, 1215930},
{20.7, 1210471},
{20.8, 1205040},
{20.9, 1199636},
{21.0, 1194259},
{21.1, 1188910},
{21.2, 1183588},
{21.3, 1178293},
{21.4, 1173025},
{21.5, 1167783},
{21.6, 1162568},
{21.7, 1157379},
{21.8, 1152216},
{21.9, 1147079},
{22.0, 1141969},
{22.1, 1136884},
{22.2, 1131824},
{22.3, 1126790},
{22.4, 1121782},
{22.5, 1116798},
{22.6, 1111840},
{22.7, 1106906},
{22.8, 1101998},
{22.9, 1097113},
{23.0, 1092254},
{23.1, 1087419},
{23.2, 1082607},
{23.3, 1077820},
{23.4, 1073057},
{23.5, 1068318},
{23.6, 1063603},
{23.7, 1058911},
{23.8, 1054242},
{23.9, 1049597},
{24.0, 1044975},
{24.1, 1040376},
{24.2, 1035800},
{24.3, 1031246},
{24.4, 1026715},
{24.5, 1022207},
{24.6, 1017722},
{24.7, 1013258},
{24.8, 1008817},
{24.9, 1004397},
{25.0, 1000000},
{25.1, 995624},
{25.2, 991271},
{25.3, 986938},
{25.4, 982627},
{25.5, 978338},
{25.6, 974069},
{25.7, 969822},
{25.8, 965596},
{25.9, 961390},
{26.0, 957205},
{26.1, 953041},
{26.2, 948898},
{26.3, 944775},
{26.4, 940672},
{26.5, 936589},
{26.6, 932526},
{26.7, 928484},
{26.8, 924461},
{26.9, 920458},
{27.0, 916474},
{27.1, 912511},
{27.2, 908566},
{27.3, 904641},
{27.4, 900735},
{27.5, 896848},
{27.6, 892980},
{27.7, 889132},
{27.8, 885301},
{27.9, 881490},
{28.0, 877697},
{28.1, 873923},
{28.2, 870167},
{28.3, 866429},
{28.4, 862710},
{28.5, 859009},
{28.6, 855325},
{28.7, 851660},
{28.8, 848012},
{28.9, 844383},
{29.0, 840770},
{29.1, 837175},
{29.2, 833598},
{29.3, 830038},
{29.4, 826495},
{29.5, 822970},
{29.6, 819461},
{29.7, 815970},
{29.8, 812495},
{29.9, 809037},
{30.0, 805596},
{30.1, 802171},
{30.2, 798763},
{30.3, 795371},
{30.4, 791996},
{30.5, 788637},
{30.6, 785294},
{30.7, 781967},
{30.8, 778656},
{30.9, 775361},
{31.0, 772082},
{31.1, 768819},
{31.2, 765571},
{31.3, 762339},
{31.4, 759122},
{31.5, 755921},
{31.6, 752735},
{31.7, 749564},
{31.8, 746409},
{31.9, 743268},
{32.0, 740143},
{32.1, 737032},
{32.2, 733937},
{32.3, 730856},
{32.4, 727789},
{32.5, 724738},
{32.6, 721700},
{32.7, 718678},
{32.8, 715669},
{32.9, 712675},
{33.0, 709696},
{33.1, 706730},
{33.2, 703778},
{33.3, 700841},
{33.4, 697917},
{33.5, 695007},
{33.6, 692111},
{33.7, 689229},
{33.8, 686360},
{33.9, 683505},
{34.0, 680664},
{34.1, 677835},
{34.2, 675021},
{34.3, 672219},
{34.4, 669431},
{34.5, 666655},
{34.6, 663893},
{34.7, 661144},
{34.8, 658408},
{34.9, 655685},
{35.0, 652974},
{35.1, 650276},
{35.2, 647591},
{35.3, 644919},
{35.4, 642259},
{35.5, 639611},
{35.6, 636976},
{35.7, 634353},
{35.8, 631743},
{35.9, 629144},
{36.0, 626558},
{36.1, 623984},
{36.2, 621422},
{36.3, 618872},
{36.4, 616334},
{36.5, 613808},
{36.6, 611293},
{36.7, 608790},
{36.8, 606299},
{36.9, 603819},
{37.0, 601351},
{37.1, 598895},
{37.2, 596450},
{37.3, 594016},
{37.4, 591593},
{37.5, 589182},
{37.6, 586782},
{37.7, 584393},
{37.8, 582015},
{37.9, 579648},
{38.0, 577292},
{38.1, 574947},
{38.2, 572613},
{38.3, 570289},
{38.4, 567976},
{38.5, 565674},
{38.6, 563383},
{38.7, 561102},
{38.8, 558832},
{38.9, 556572},
{39.0, 554322},
{39.1, 552083},
{39.2, 549854},
{39.3, 547636},
{39.4, 545427},
{39.5, 543229},
{39.6, 541041},
{39.7, 538863},
{39.8, 536694},
{39.9, 534536},
{40.0, 532388},
{40.1, 530249},
{40.2, 528121},
{40.3, 526002},
{40.4, 523892},
{40.5, 521792},
{40.6, 519702},
{40.7, 517622},
{40.8, 515551},
{40.9, 513489},
{41.0, 511437},
{41.1, 509394},
{41.2, 507360},
{41.3, 505336},
{41.4, 503321},
{41.5, 501315},
{41.6, 499318},
{41.7, 497330},
{41.8, 495351},
{41.9, 493381},
{42.0, 491420},
{42.1, 489468},
{42.2, 487525},
{42.3, 485590},
{42.4, 483665},
{42.5, 481748},
{42.6, 479839},
{42.7, 477940},
{42.8, 476048},
{42.9, 474166},
{43.0, 472292},
{43.1, 470426},
{43.2, 468569},
{43.3, 466720},
{43.4, 464879},
{43.5, 463047},
{43.6, 461223},
{43.7, 459407},
{43.8, 457599},
{43.9, 455799},
{44.0, 454008},
{44.1, 452224},
{44.2, 450449},
{44.3, 448681},
{44.4, 446922},
{44.5, 445170},
{44.6, 443426},
{44.7, 441690},
{44.8, 439961},
{44.9, 438240},
{45.0, 436527},
{45.1, 434822},
{45.2, 433124},
{45.3, 431434},
{45.4, 429751},
{45.5, 428076},
{45.6, 426408},
{45.7, 424748},
{45.8, 423095},
{45.9, 421449},
{46.0, 419811},
{46.1, 418180},
{46.2, 416556},
{46.3, 414939},
{46.4, 413330},
{46.5, 411727},
{46.6, 410132},
{46.7, 408544},
{46.8, 406963},
{46.9, 405388},
{47.0, 403821},
{47.1, 402261},
{47.2, 400707},
{47.3, 399161},
{47.4, 397621},
{47.5, 396088},
{47.6, 394562},
{47.7, 393042},
{47.8, 391529},
{47.9, 390023},
{48.0, 388523},
{48.1, 387030},
{48.2, 385544},
{48.3, 384064},
{48.4, 382591},
{48.5, 381124},
{48.6, 379663},
{48.7, 378209},
{48.8, 376761},
{48.9, 375320},
{49.0, 373884},
{49.1, 372456},
{49.2, 371033},
{49.3, 369616},
{49.4, 368206},
{49.5, 366802},
{49.6, 365404},
{49.7, 364012},
{49.8, 362626},
{49.9, 361246},
{50.0, 359872},
{50.1, 358505},
{50.2, 357143},
{50.3, 355787},
{50.4, 354437},
{50.5, 353092},
{50.6, 351754},
{50.7, 350421},
{50.8, 349094},
{50.9, 347773},
{51.0, 346458},
{51.1, 345148},
{51.2, 343844},
{51.3, 342546},
{51.4, 341253},
{51.5, 339965},
{51.6, 338684},
{51.7, 337408},
{51.8, 336137},
{51.9, 334872},
{52.0, 333612},
{52.1, 332358},
{52.2, 331109},
{52.3, 329865},
{52.4, 328627},
{52.5, 327394},
{52.6, 326166},
{52.7, 324944},
{52.8, 323727},
{52.9, 322515},
{53.0, 321308},
{53.1, 320107},
{53.2, 318911},
{53.3, 317719},
{53.4, 316533},
{53.5, 315352},
{53.6, 314176},
{53.7, 313005},
{53.8, 311839},
{53.9, 310678},
{54.0, 309522},
{54.1, 308370},
{54.2, 307224},
{54.3, 306083},
{54.4, 304946},
{54.5, 303814},
{54.6, 302687},
{54.7, 301565},
{54.8, 300448},
{54.9, 299335},
{55.0, 298227},
{55.1, 297124},
{55.2, 296025},
{55.3, 294931},
{55.4, 293842},
{55.5, 292758},
{55.6, 291677},
{55.7, 290602},
{55.8, 289531},
{55.9, 288464},
{56.0, 287402},
{56.1, 286345},
{56.2, 285292},
{56.3, 284243},
{56.4, 283199},
{56.5, 282159},
{56.6, 281124},
{56.7, 280093},
{56.8, 279066},
{56.9, 278044},
{57.0, 277026},
{57.1, 276012},
{57.2, 275002},
{57.3, 273997},
{57.4, 272996},
{57.5, 271999},
{57.6, 271006},
{57.7, 270017},
{57.8, 269033},
{57.9, 268052},
{58.0, 267076},
{58.1, 266104},
{58.2, 265136},
{58.3, 264172},
{58.4, 263212},
{58.5, 262256},
{58.6, 261303},
{58.7, 260355},
{58.8, 259411},
{58.9, 258471},
{59.0, 257534},
{59.1, 256602},
{59.2, 255673},
{59.3, 254749},
{59.4, 253828},
{59.5, 252911},
{59.6, 251997},
{59.7, 251088},
{59.8, 250182},
{59.9, 249280},
{60.0, 248382}};

typedef int (*cmp_func_t)(const void *a, const void *b);

int cmp_func(const void *a, const void *b)
{
	if (*((uint32_t *)a) > ((struct _ntc_tab *)b)->r)
		return -1;
	if (*((uint32_t *)a) < ((struct _ntc_tab *)b)->r)
		return 1;
	return 0;
}

void *bsearch(const void *key, const void *base, int num, int size, cmp_func_t cmp)
{
	const char *pivot;
	int result;

	while (num > 0) {
		pivot = base + (num >> 1) * size;
		result = cmp(key, pivot);
		if (result == 0)
			return (void *)pivot;

		if (result > 0) {
			base = pivot + size;
			num--;
		}
		num >>= 1;

		if (num == 0)
			return (void *)base;
	}

	return 0;
}

double get_temperature_by_resistance(uint32_t r)
{
	uint32_t r1 = 0;
	uint32_t r2 = 0;
	double t1 = 0;
	double t2 = 0;
	double result = 0;

	r *= 100;

	if (r <= ntc_tab[(sizeof(ntc_tab) / sizeof(ntc_tab[0])) - 1].r)
		return ntc_tab[(sizeof(ntc_tab) / sizeof(ntc_tab[0])) - 1].t;

	if (r >= ntc_tab[0].r)
		return ntc_tab[0].t;

	struct _ntc_tab *val = bsearch(&r, &ntc_tab[0],
			(sizeof(ntc_tab) / sizeof(ntc_tab[0])),
			sizeof(ntc_tab[0]), cmp_func);

	if (val->r == r)
		return val->t;

	if (val->r > r) {
		r2 = val->r;
		r1 = ((struct _ntc_tab *)((char *)val + sizeof(ntc_tab[0])))->r;

		t2 = val->t;
		t1 = ((struct _ntc_tab *)((char *)val + sizeof(ntc_tab[0])))->t;

	}

	if (val->r < r) {
		r1 = val->r;
		r2 = ((struct _ntc_tab *)((char *)val - sizeof(ntc_tab[0])))->r;

		t1 = val->t;
		t2 = ((struct _ntc_tab *)((char *)val - sizeof(ntc_tab[0])))->t;
	}

	result = t1 - (((int)r - (int)r1) * ((double)(t1 - t2) / ((int)r2 - (int)r1)));
	return result;
}
